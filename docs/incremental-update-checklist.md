# 差分更新機能実装チェックリスト

## ✅ 完了済み項目

### フロントエンド実装
- [x] 差分更新ボタンの実装確認
- [x] バックエンドAPIとの接続実装
- [x] 成功時のユーザーフィードバック追加
- [x] エラーハンドリングの改善
- [x] 差分更新後の全データ再取得実装
- [x] メッセージ表示の統一化
- [x] メッセージの自動クリア機能

### バックエンド実装
- [x] `/api/data-collection/update` エンドポイント確認
- [x] `HistoricalDataService.collect_incremental_data` メソッド確認
- [x] 差分更新ロジックの実装確認
- [x] エラーハンドリングの実装確認
- [x] レスポンス形式の統一

### テスト実装
- [x] バックエンドAPIテストの作成
- [x] フロントエンドコンポーネントテストの作成
- [x] エラーケースのテスト作成
- [x] 成功ケースのテスト作成

### ドキュメント
- [x] 実装ドキュメントの作成
- [x] API仕様の文書化
- [x] 使用方法の説明
- [x] チェックリストの作成

## 🔄 動作確認項目

### 基本動作確認
- [ ] バックエンドサーバーの起動確認
- [ ] フロントエンドアプリケーションの起動確認
- [ ] データページへのアクセス確認
- [ ] 差分更新ボタンの表示確認

### 機能動作確認
- [ ] 差分更新ボタンのクリック動作
- [ ] APIエンドポイントの呼び出し確認
- [ ] 成功時のメッセージ表示確認
- [ ] エラー時のメッセージ表示確認
- [ ] データ再取得の動作確認

### エラーケース確認
- [ ] バックエンドサーバー停止時の動作
- [ ] ネットワークエラー時の動作
- [ ] 無効なパラメータでの動作
- [ ] データベース接続エラー時の動作

## 🧪 テスト実行

### バックエンドテスト
```bash
cd backend
python -m pytest tests/test_incremental_update.py -v
```

### フロントエンドテスト
```bash
cd frontend
npm test -- __tests__/incremental-update.test.tsx
```

## 🚀 デプロイ前確認

### コード品質
- [ ] ESLintエラーの解消
- [ ] TypeScriptエラーの解消
- [ ] Pythonコードの型チェック
- [ ] コードフォーマットの統一

### パフォーマンス
- [ ] API応答時間の確認
- [ ] フロントエンドレンダリング性能の確認
- [ ] メモリ使用量の確認
- [ ] データベースクエリの最適化確認

### セキュリティ
- [ ] 入力値検証の確認
- [ ] SQLインジェクション対策の確認
- [ ] XSS対策の確認
- [ ] CSRF対策の確認

## 📋 動作確認手順

### 1. 環境準備
```bash
# バックエンド起動
cd backend
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# フロントエンド起動（別ターミナル）
cd frontend
npm run dev
```

### 2. 基本動作確認
1. ブラウザで http://localhost:3000/data にアクセス
2. 通貨ペア「BTC/USDT:USDT」、時間軸「1h」を選択
3. 「差分更新」ボタンをクリック
4. メッセージ表示を確認

### 3. 成功ケース確認
- 既存データがある場合の差分更新
- 新しいデータがない場合の処理
- 初回データ収集の場合の処理

### 4. エラーケース確認
- バックエンドサーバー停止状態での操作
- 無効なシンボルでの操作
- ネットワーク接続エラーのシミュレーション

## 🐛 既知の問題と対応

### TestClient の問題
- **問題**: `TestClient(app=app)` でエラーが発生
- **対応**: `TestClient(app)` に修正済み
- **状況**: 要再テスト

### 非同期テストの問題
- **問題**: 一部の非同期テストがスキップされる
- **対応**: pytest-asyncio の設定確認が必要
- **状況**: 要調査

## 📝 次のステップ

### 短期的改善
1. テストの修正と実行確認
2. 実際の動作確認とデバッグ
3. エラーハンドリングの微調整
4. ユーザビリティの改善

### 中期的改善
1. リアルタイム更新機能の検討
2. バッチ処理機能の追加
3. 進捗表示機能の実装
4. 自動更新機能の検討

### 長期的改善
1. WebSocket を使用したリアルタイム通信
2. 通知機能の実装
3. パフォーマンス最適化
4. 監視・ログ機能の強化

## 📞 サポート

### 問題が発生した場合
1. ブラウザの開発者ツールでエラーログを確認
2. バックエンドのログファイルを確認
3. ネットワーク接続状況を確認
4. データベースの状態を確認

### デバッグ情報の収集
- フロントエンド: ブラウザのコンソールログ
- バックエンド: アプリケーションログ
- ネットワーク: ブラウザのネットワークタブ
- データベース: クエリログ
