# ハイパーパラメータ最適化ユーザーガイド

## 概要

ハイパーパラメータ最適化機能は、機械学習モデルの性能を自動的に向上させるための強力なツールです。手動でパラメータを調整する必要がなく、最適なパラメータ組み合わせを効率的に見つけることができます。

## 機能の特徴

### 🎯 自動最適化
- チェックボックス1つで最適化を有効化
- 最適化されたパラメータで自動的にモデル学習
- プロファイル保存・読み込みが不要

### 🔧 3つの最適化手法
- **ベイジアン最適化**: 効率的で高精度
- **グリッドサーチ**: 網羅的で確実
- **ランダムサーチ**: 高速でシンプル

### 📊 詳細な結果表示
- 最適パラメータの表示
- 最適化履歴の可視化
- 収束情報の提供

## 使用方法

### 1. 基本的な使用手順

1. **MLトレーニングページにアクセス**
   - サイドメニューから「ML」→「トレーニング」を選択

2. **基本設定を入力**
   - 取引ペア、時間足、期間などを設定

3. **最適化設定を有効化**
   - 「ハイパーパラメータ自動最適化を有効にする」をチェック

4. **最適化手法を選択**
   - ベイジアン最適化、グリッドサーチ、ランダムサーチから選択

5. **パラメータ空間を設定**
   - 最適化対象のパラメータと範囲を指定

6. **トレーニング開始**
   - 「最適化付きトレーニング開始」ボタンをクリック

### 2. 最適化手法の選び方

#### ベイジアン最適化
```
✅ 推奨する場面:
- 高精度な結果が必要
- 試行回数を抑えたい
- 計算コストが高い

⚙️ 設定例:
- 試行回数: 20-50回
- パラメータ数: 3-8個
```

#### グリッドサーチ
```
✅ 推奨する場面:
- 確実に最適解を見つけたい
- パラメータ数が少ない
- 計算時間に余裕がある

⚙️ 設定例:
- 試行回数: 組み合わせ数に依存
- パラメータ数: 1-3個
```

#### ランダムサーチ
```
✅ 推奨する場面:
- 素早くベースライン確認
- パラメータ数が多い
- 初回実行時

⚙️ 設定例:
- 試行回数: 50-100回
- パラメータ数: 制限なし
```

### 3. パラメータ空間の設定

#### 実数パラメータ
```
例: learning_rate
- 型: 実数
- 最小値: 0.01
- 最大値: 0.3
- 説明: 学習率の範囲を指定
```

#### 整数パラメータ
```
例: num_leaves
- 型: 整数
- 最小値: 10
- 最大値: 100
- 説明: 葉の数の範囲を指定
```

#### カテゴリカルパラメータ
```
例: boosting_type
- 型: カテゴリ
- 選択肢: gbdt, dart, goss
- 説明: ブースティング手法を選択
```

## 実践例

### 例1: 初心者向け設定

```yaml
最適化手法: ランダムサーチ
試行回数: 30回
パラメータ:
  - num_leaves: 20-80 (整数)
  - learning_rate: 0.05-0.2 (実数)
```

この設定は：
- 設定が簡単
- 実行時間が短い
- 基本的な性能向上が期待できる

### 例2: 中級者向け設定

```yaml
最適化手法: ベイジアン最適化
試行回数: 40回
パラメータ:
  - num_leaves: 10-100 (整数)
  - learning_rate: 0.01-0.3 (実数)
  - feature_fraction: 0.5-1.0 (実数)
  - min_data_in_leaf: 5-50 (整数)
```

この設定は：
- バランスの取れた最適化
- 適度な実行時間
- 高い性能向上が期待できる

### 例3: 上級者向け設定

```yaml
最適化手法: ベイジアン最適化
試行回数: 60回
パラメータ:
  - num_leaves: 10-100 (整数)
  - learning_rate: 0.01-0.3 (実数)
  - feature_fraction: 0.5-1.0 (実数)
  - bagging_fraction: 0.5-1.0 (実数)
  - min_data_in_leaf: 5-50 (整数)
  - max_depth: 3-15 (整数)
```

この設定は：
- 最高精度を追求
- 実行時間は長め
- 最大の性能向上が期待できる

## 結果の解釈

### 最適化結果の見方

```json
{
  "optimization_result": {
    "method": "bayesian",
    "best_params": {
      "num_leaves": 45,
      "learning_rate": 0.12
    },
    "best_score": 0.82,
    "total_evaluations": 40,
    "optimization_time": 125.6
  }
}
```

- **best_params**: 最適なパラメータ組み合わせ
- **best_score**: 最高スコア（F1スコア）
- **total_evaluations**: 実際の評価回数
- **optimization_time**: 最適化にかかった時間（秒）

### 性能改善の確認

最適化前後の性能を比較：

```
最適化前: F1スコア 0.75
最適化後: F1スコア 0.82
改善率: +9.3%
```

## トラブルシューティング

### よくある問題と解決方法

#### 1. 最適化が遅い
```
原因: パラメータ数が多すぎる
解決: 重要なパラメータに絞る

原因: 試行回数が多すぎる
解決: 試行回数を減らす
```

#### 2. 性能が改善しない
```
原因: パラメータ範囲が狭すぎる
解決: 範囲を広げる

原因: 試行回数が少なすぎる
解決: 試行回数を増やす
```

#### 3. エラーが発生する
```
原因: 無効なパラメータ範囲
解決: 最小値 < 最大値を確認

原因: カテゴリが空
解決: 有効な選択肢を設定
```

## ベストプラクティス

### 1. 段階的アプローチ
1. ランダムサーチで全体像把握
2. ベイジアン最適化で精密調整
3. 必要に応じてグリッドサーチで確認

### 2. パラメータ選択
- 影響の大きいパラメータを優先
- 相関の高いパラメータは避ける
- 計算コストを考慮

### 3. 実行時間管理
- 試行回数は段階的に増加
- 時間制限を設定
- 進捗を定期的に確認

### 4. 結果の活用
- 最適パラメータを記録
- 複数回実行して安定性確認
- 異なるデータセットでも検証

## 注意事項

- 最適化中はブラウザを閉じないでください
- 大量のデータでは時間がかかる場合があります
- 同時に複数の最適化を実行しないでください
- 定期的に結果をバックアップしてください
