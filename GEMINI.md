# Trdinger プロジェクト (`GEMINI.md`)

このドキュメントは、Trdinger プロジェクトの包括的な概要、構造、および開発規約を提供し、AI 主導の開発のための基本的なコンテキストとして機能します。

## プロジェクト概要

Trdinger は、仮想通貨取引戦略を科学的に研究、バックテスト、最適化するためのフルスタックのエンタープライズグレードプラットフォームです。Python バックエンドと TypeScript/Next.js フロントエンドを含むモノレポとして構築されています。

### 主要コンポーネント

*   **バックエンド**: コアエンジンとして機能する強力な FastAPI アプリケーションです。以下の機能を担当します。
    *   **データサービス**: CCXT ライブラリを介した市場データ（OHLCV、ファンディングレート、建玉）の収集、保存、取得。
    *   **バックテストエンジン**: 履歴データに対して取引戦略を評価し、詳細な統計分析を提供する洗練されたシステム。
    *   **機械学習**: モデルトレーニング（例: LightGBM）、評価、特徴量重要度分析、管理のための統合された ML パイプライン。
    *   **遺伝的アルゴリズム**: 遺伝的アルゴリズム（DEAP）を使用して取引ルールを進化させ、最適化する自動戦略発見モジュール。
    *   **データベース**: データ永続化のための SQLAlchemy を使用した PostgreSQL、およびマイグレーションのための Alembic。

*   **フロントエンド**: Next.js (App Router) と TypeScript で構築されたモダンでレスポンシブな Web インターフェースです。以下の機能を提供します。
    *   **インタラクティブダッシュボード**: バックテスト結果、ML モデルのパフォーマンス、市場データの豊富な視覚化（Recharts を使用）。
    *   **設定管理**: バックテスト、ML トレーニングパラメータ、データ収集タスクを設定するためのユーザーフレンドリーなフォーム。
    *   **UI/UX**: Tailwind CSS、shadcn/ui コンポーネント、および状態管理のための Zustand で構築された洗練された一貫性のあるユーザーエクスペリエンス。

## ディレクトリ構造

```
trading/
├── backend/                 # FastAPIバックエンド
│   ├── app/
│   │   ├── api/           # APIエンドポイント
│   │   ├── services/      # コアサービス
│   │   │   ├── auto_strategy/  # GAコアモジュール
│   │   │   ├── backtest/     # バックテストサービス
│   │   │   ├── data_collection/  # 市場データ収集
│   │   │   ├── indicators/     # テクニカルインジケーター
│   │   │   └── ml/           # 機械学習サービス
│   │   ├── config/        # 設定管理
│   │   └── utils/         # 共通ユーティリティ
│   ├── database/          # SQLAlchemyモデルとリポジトリ
│   ├── tests/             # Pytestテスト
│   ├── main.py            # アプリケーションエントリーポイント
│   └── pyproject.toml     # Python依存関係とツール設定
├── frontend/                # Next.jsフロントエンド
│   ├── app/               # Next.js App Router（ページとレイアウト）
│   ├── components/        # 再利用可能なUIコンポーネント
│   ├── hooks/             # Reactカスタムフック
│   ├── constants/         # 定数
│   ├── types/             # TypeScript型定義
│   ├── tests/             # Jestテスト
│   └── package.json       # Node.js依存関係
└── .github/                 # GitHub Actionsワークフロー
    └── workflows/
        ├── backend-ci.yml
        └── frontend-ci.yml
```

## ビルドと実行

### バックエンド

バックエンドは、`pip` と `setuptools` で管理される標準的な Python プロジェクトです。

1.  **仮想環境のセットアップ**:
    ```bash
    python -m venv venv
    source venv/bin/activate # Windows の場合: venv\Scripts\activate
    ```

2.  **依存関係のインストール**: `backend` ディレクトリに移動し、依存関係をインストールします。`.[test,dev]` エクストラには、テストとリンティング用のパッケージが含まれています。
    ```bash
    cd backend
    pip install -e .[test,dev]
    ```

3.  **開発サーバーの起動**: アプリケーションは Uvicorn を使用して提供されます。
    ```bash
    uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
    ```

4.  **テストの実行**: テストは `pytest` を使用して実行されます。
    ```bash
    pytest
    ```

### フロントエンド

フロントエンドは、`npm` で管理される標準的な Node.js プロジェクトです。

1.  **依存関係のインストール**: `frontend` ディレクトリに移動し、再現性のあるビルドのために `npm ci` を使用して依存関係をインストールします。
    ```bash
    cd frontend
    npm ci
    ```

2.  **開発サーバーの起動**:
    ```bash
    npm run dev
    ```
    アプリケーションは `http://localhost:3000` で利用可能になります。

3.  **本番ビルド**:
    ```bash
    npm run build
    ```

4.  **テストの実行**: テストは Jest を使用して実行されます。
    ```bash
    npm test
    ```

## 開発規約

### バックエンド

*   **リンティングとフォーマット**: コードベースは、`black`、`isort`、`flake8` を使用して厳密にフォーマットおよびリンティングされています。これらのチェックは CI パイプラインで強制されます。
*   **型チェック**: `mypy` を使用して静的型チェックが強制されます。すべての新しいコードは完全に型アノテーションされるべきです。
*   **テスト**: `pytest` がテストフレームワークです。テストは `backend/tests/` ディレクトリに配置され、アプリケーションの構造を反映するように整理されています。サービスとデータベースの相互作用を分離するためにモックが多用されます。
*   **設定**: アプリケーション設定は、`app/config/` にある統合された YAML ベースのシステムを介して管理されます。

### フロントエンド

*   **言語**: すべてのコードに TypeScript が使用されます。
*   **リンティングとフォーマット**: `eslint` と `prettier`（Next.js ツールチェーンと統合）がコード品質と一貫性のために使用されます。
*   **コンポーネントライブラリ**: UI は、アクセス可能で構成可能な React コンポーネントのセットを提供する `shadcn/ui` を使用して構築されています。アイコンは `lucide-react` から提供されます。
*   **スタイリング**: すべてのスタイリングに `Tailwind CSS` が使用されます。
*   **テスト**: `jest` と `@testing-library/react` がコンポーネントおよび統合テストに使用されます。テストファイルは、テスト対象のコンポーネントと同じ場所に配置されるか、`frontend/tests/` ディレクトリに配置されます。
*   **状態管理**: 分析されたファイルには明示的に定義されていませんが、複雑なクライアントサイドの状態には Zustand や Jotai のような最新の状態管理ライブラリが使用されている可能性があります。

### Git & CI/CD

*   **CI パイプライン**: GitHub Actions は、バックエンドとフロントエンドの両方 (`.github/workflows/`) に設定されています。パイプラインは、`main` ブランチへのすべてのプッシュおよびプルリクエストで、リンティング、型チェック、テスト、およびビルド検証を自動的に実行します。
*   **コミット**: 明示的に強制されていませんが、コミットメッセージは明確で記述的であるべきで、変更の「内容」と「理由」を説明する必要があります。